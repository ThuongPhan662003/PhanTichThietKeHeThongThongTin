{% extends "admin/base.html" %} {% block title %}Tạo tài khoản{% endblock %} {%
block content %} {% for message in get_flashed_messages() %}
<div
  class="alert alert-dismissible fade show custom-alert alert-warning"
  role="alert"
  id="alertMessage"
>
  <div class="d-flex align-items-center">
    <ion-icon name="warning-outline" class="alert-icon"></ion-icon>
    <div class="message-text">
      <strong>{{ message }}</strong>
    </div>
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="alert"
      aria-label="Close"
    ></button>
  </div>
</div>
{% endfor %}

<div class="d-flex">
  <!-- Phần Form Tạo Tài Khoản -->
  <div class="col-md-6">
    <h2>Tạo tài khoản</h2>
    <form method="post" action="{{ url_for('admin.sign_up') }}">
      <!-- Full Name Input -->
      <div class="form-group">
        <ion-icon name="person-outline"></ion-icon>
        <input
          type="text"
          placeholder="UserName"
          name="UserName"
          required
          id="UserName"
        />
      </div>

      <div class="form-group">
        <ion-icon name="lock-closed-outline"></ion-icon>
        <input
          type="password"
          placeholder="Mật khẩu"
          name="MatKhau1"
          required
          id="MatKhau1"
        />
        <ion-icon
          name="eye-off-outline"
          class="toggle-password"
          onclick="togglePasswordVisibility()"
        ></ion-icon>
      </div>

      <!-- Confirm Password Input -->
      <div class="form-group">
        <ion-icon name="lock-closed-outline"></ion-icon>
        <input
          type="password"
          placeholder="Xác nhận mật khẩu"
          name="MatKhau2"
          required
          id="MatKhau2"
        />
        <ion-icon
          name="eye-off-outline"
          class="toggle-password"
          onclick="togglePasswordVisibility()"
        ></ion-icon>
      </div>

      <div class="form-group">
        <label for="selectedEmployee">Mã NV:</label>
        <input
          type="text"
          id="selectedEmployee"
          class="form-control"
          readonly
        />
      </div>
      <div class="form-group">
        <label for="role">Chọn Vai Trò:</label>
        <select id="role" name="role" class="form-select" required>
          {% for role in roles %}
          {% if role.TenNhomNguoiDung != "Khách hàng"%}
          
          <option value="{{ role.MaNND }}">{{ role.TenNhomNguoiDung }}</option>
          {% endif %}
          {% endfor %}
        </select>
      </div>

      <button type="submit" class="btn">Đăng ký</button>
    </form>
  </div>

  <!-- Phần Bảng Nhân Viên -->
  <div class="col-md-6">
    <h2>Chọn Nhân Viên</h2>
    <!-- Tìm kiếm -->
    <div class="mb-3">
      <label for="searchField">Tìm kiếm theo:</label>
      <select id="searchField" class="form-select mb-2">
        <option value="MaNV">Mã NV</option>
        <option value="TenNV">Tên nhân viên</option>
        <option value="HoNV">Họ nhân viên</option>
      </select>
      <input
        type="text"
        id="searchInput"
        class="form-control"
        placeholder="Nhập từ khóa để tìm kiếm..."
      />
    </div>

    <!-- Bảng nhân viên -->
    <table class="table table-hover" id="employeeTable">
      <thead>
        <tr>
          <th scope="col">Mã NV</th>
          <th scope="col">Họ</th>
          <th scope="col">Tên</th>
        </tr>
      </thead>
      <tbody>
        {% for employee in employees %}
        <tr data-id="{{ employee.MaNV }}">
          <td>{{ employee.MaNV }}</td>
          <td>{{ employee.HoNV }}</td>
          <td>{{ employee.TenNV }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
  // Hàm lọc nhân viên theo từ khóa tìm kiếm
  document.getElementById("searchInput").addEventListener("input", function () {
    var searchValue = this.value.toLowerCase();
    var searchField = document.getElementById("searchField").value;
    var rows = document.querySelectorAll("#employeeTable tbody tr");

    rows.forEach(function (row) {
      var cellValue = row
        .querySelector(
          "td:nth-child(" +
            (searchField === "MaNV" ? 1 : searchField === "HoNV" ? 2 : 3) +
            ")"
        )
        .textContent.toLowerCase();
      if (cellValue.indexOf(searchValue) > -1) {
        row.style.display = "";
      } else {
        row.style.display = "none";
      }
    });
  });

  // Hàm để chọn nhân viên và hiển thị mã nhân viên vào form
  document.querySelectorAll("#employeeTable tbody tr").forEach(function (row) {
    row.addEventListener("click", function () {
      var employeeId = this.getAttribute("data-id");
      document.getElementById("selectedEmployee").value = employeeId;

      // Đánh dấu hàng được chọn (in đậm)
      document
        .querySelectorAll("#employeeTable tbody tr")
        .forEach(function (r) {
          r.classList.remove("selected");
        });
      this.classList.add("selected");
    });
  });

  // Hàm toggle ẩn/hiện mật khẩu
  function togglePasswordVisibility() {
    var passwordFields = document.querySelectorAll("#MatKhau1, #MatKhau2");
    passwordFields.forEach(function (field) {
      if (field.type === "password") {
        field.type = "text";
      } else {
        field.type = "password";
      }
    });
  }

  // Tự động ẩn thông báo sau 10 giây
  window.addEventListener("DOMContentLoaded", function () {
    var alertMessage = document.getElementById("alertMessage");
    if (alertMessage) {
      setTimeout(function () {
        alertMessage.classList.add("fade");
        setTimeout(function () {
          alertMessage.style.display = "none";
        }, 150); // Chờ fade-out hoàn thành
      }, 10000); // Sau 10 giây
    }
  });
</script>
{% endblock %}
